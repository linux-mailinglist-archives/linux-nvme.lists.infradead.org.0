Return-Path: <linux-nvme-bounces+lists+linux-nvme=lfdr.de@lists.infradead.org>
X-Original-To: lists+linux-nvme@lfdr.de
Delivered-To: lists+linux-nvme@lfdr.de
Received: from bombadil.infradead.org (bombadil.infradead.org [IPv6:2607:7c80:54:e::133])
	by mail.lfdr.de (Postfix) with ESMTPS id 289C91FF5D9
	for <lists+linux-nvme@lfdr.de>; Thu, 18 Jun 2020 16:55:24 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20170209; h=Sender:
	Content-Transfer-Encoding:Content-Type:Cc:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=miWLh9fwoNMwUwANKtqb1wfVUa1p/NIE8RHbiiNG4kg=; b=KvfWcEn56bYDON
	PQJhw29BNtpTsmafa230EC6kELFLV0mhi4OJEKhXzpQdjgTi5iy7pPnBo6NWg2N0dNU37wCuT2wEj
	/4zPfNnrSfnsZyYmNJq3RgBV2aJvs8dq++KbIRyKRY0WdK9cf6MfJX0HdfcNBUZaLrv3VdYnBQ4Ky
	S/gJ3hXjYYotUSCc2kMA352gY/i6l8Ewox7BbYwsGERSWIcndL8c6ZOgUuGSXznkJl47BESmcJHbo
	sW/ZbGfcuP+4R0u04ifE9+ya6wGmpjK2FsTBZfrBen6/sjZs0631Z83RhWmKRCXTwH2MGuZSO8mB1
	UVtFAtoxqdQr2YqHfrcw==;
Received: from localhost ([127.0.0.1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.92.3 #3 (Red Hat Linux))
	id 1jlvwg-0004AE-NZ; Thu, 18 Jun 2020 14:55:14 +0000
Received: from mail.kernel.org ([198.145.29.99])
 by bombadil.infradead.org with esmtps (Exim 4.92.3 #3 (Red Hat Linux))
 id 1jlvvc-0003Rz-Iw
 for linux-nvme@lists.infradead.org; Thu, 18 Jun 2020 14:54:10 +0000
Received: from dhcp-10-100-145-180.wdl.wdc.com (unknown [199.255.45.60])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id AD91620897;
 Thu, 18 Jun 2020 14:54:07 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1592492048;
 bh=OsV2e+PrANXQbKd1rLIzwqqagQ2DDLNXwifleLm6Y1M=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=ALbU1sGI6BLHPBh33wl729i6H8rNCLyknb316aGS4tAqA/54VHP2hNqN8GuNciX1a
 Xiw5VsURTfFnhtJD/diRxXvrO9Fi9wypDCctfKBHULlvRgB8XwHj8BajeeGRv8JCvR
 yiZIerFMhZD/JLw6vLIPxOLSez78M/S7sbxedSGY=
From: Keith Busch <kbusch@kernel.org>
To: linux-nvme@lists.infradead.org, linux-block@vger.kernel.org, hch@lst.de,
 sagi@grimberg.me
Subject: [PATCHv2 4/5] nvme: support for multi-command set effects
Date: Thu, 18 Jun 2020 07:53:53 -0700
Message-Id: <20200618145354.1139350-5-kbusch@kernel.org>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200618145354.1139350-1-kbusch@kernel.org>
References: <20200618145354.1139350-1-kbusch@kernel.org>
MIME-Version: 1.0
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20200618_075408_679635_1E8E9B62 
X-CRM114-Status: GOOD (  16.68  )
X-Spam-Score: -5.2 (-----)
X-Spam-Report: SpamAssassin version 3.4.4 on bombadil.infradead.org summary:
 Content analysis details:   (-5.2 points)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -5.0 RCVD_IN_DNSWL_HI       RBL: Sender listed at https://www.dnswl.org/,
 high trust [198.145.29.99 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
 0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
 envelope-from domain
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature, not necessarily
 valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's domain
 -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 -0.0 DKIMWL_WL_HIGH         DKIMwl.org - Whitelisted High sender
X-BeenThere: linux-nvme@lists.infradead.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <linux-nvme.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/linux-nvme>,
 <mailto:linux-nvme-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/linux-nvme/>
List-Post: <mailto:linux-nvme@lists.infradead.org>
List-Help: <mailto:linux-nvme-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/linux-nvme>,
 <mailto:linux-nvme-request@lists.infradead.org?subject=subscribe>
Cc: axboe@kernel.dk,
 =?UTF-8?q?Javier=20Gonz=C3=A1lez?= <javier.gonz@samsung.com>,
 "Martin K . Petersen" <martin.petersen@oracle.com>,
 Keith Busch <keith.busch@wdc.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: "linux-nvme" <linux-nvme-bounces@lists.infradead.org>
Errors-To: linux-nvme-bounces+lists+linux-nvme=lfdr.de@lists.infradead.org

RnJvbTogS2VpdGggQnVzY2ggPGtlaXRoLmJ1c2NoQHdkYy5jb20+CgpUaGUgQ29tbWFuZHMgU3Vw
cG9ydGVkIGFuZCBFZmZlY3RzIGxvZyBwYWdlIHdhcyBleHRlbmRlZCB3aXRoIGEgQ1NJCmZpZWxk
IHRoYXQgZW5hYmxlcyB0aGUgaG9zdCB0byBxdWVyeSB0aGUgbG9nIHBhZ2UgZm9yIGVhY2ggY29t
bWFuZCBzZXQKc3VwcG9ydGVkLiBSZXRyaWV2ZSB0aGlzIGxvZyBwYWdlIGZvciBlYWNoIGNvbW1h
bmQgc2V0IHRoYXQgYW4gYXR0YWNoZWQKbmFtZXNwYWNlIHN1cHBvcnRzLCBhbmQgc2F2ZSBhIHBv
aW50ZXIgdG8gdGhhdCBsb2cgaW4gdGhlIG5hbWVzcGFjZSBoZWFkLgoKUmV2aWV3ZWQtYnk6IEph
dmllciBHb256w6FsZXogPGphdmllci5nb256QHNhbXN1bmcuY29tPgpSZXZpZXdlZC1ieTogTWFy
dGluIEsuIFBldGVyc2VuIDxtYXJ0aW4ucGV0ZXJzZW5Ab3JhY2xlLmNvbT4KU2lnbmVkLW9mZi1i
eTogS2VpdGggQnVzY2ggPGtlaXRoLmJ1c2NoQHdkYy5jb20+Ci0tLQogZHJpdmVycy9udm1lL2hv
c3QvY29yZS5jICAgICAgfCA3OSArKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQog
ZHJpdmVycy9udm1lL2hvc3QvaHdtb24uYyAgICAgfCAgMiArLQogZHJpdmVycy9udm1lL2hvc3Qv
bGlnaHRudm0uYyAgfCAgNCArLQogZHJpdmVycy9udm1lL2hvc3QvbXVsdGlwYXRoLmMgfCAgMiAr
LQogZHJpdmVycy9udm1lL2hvc3QvbnZtZS5oICAgICAgfCAxMSArKysrLQogaW5jbHVkZS9saW51
eC9udm1lLmggICAgICAgICAgfCAgNCArLQogNiBmaWxlcyBjaGFuZ2VkLCA3NyBpbnNlcnRpb25z
KCspLCAyNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL252bWUvaG9zdC9jb3Jl
LmMgYi9kcml2ZXJzL252bWUvaG9zdC9jb3JlLmMKaW5kZXggNDVhM2NiNWEzNWJkLi42NGI3Yjlm
YzI4MTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbnZtZS9ob3N0L2NvcmUuYworKysgYi9kcml2ZXJz
L252bWUvaG9zdC9jb3JlLmMKQEAgLTEzNjMsOCArMTM2Myw4IEBAIHN0YXRpYyB1MzIgbnZtZV9w
YXNzdGhydV9zdGFydChzdHJ1Y3QgbnZtZV9jdHJsICpjdHJsLCBzdHJ1Y3QgbnZtZV9ucyAqbnMs
CiAJdTMyIGVmZmVjdHMgPSAwOwogCiAJaWYgKG5zKSB7Ci0JCWlmIChjdHJsLT5lZmZlY3RzKQot
CQkJZWZmZWN0cyA9IGxlMzJfdG9fY3B1KGN0cmwtPmVmZmVjdHMtPmlvY3Nbb3Bjb2RlXSk7CisJ
CWlmIChucy0+aGVhZC0+ZWZmZWN0cykKKwkJCWVmZmVjdHMgPSBsZTMyX3RvX2NwdShucy0+aGVh
ZC0+ZWZmZWN0cy0+aW9jc1tvcGNvZGVdKTsKIAkJaWYgKGVmZmVjdHMgJiB+KE5WTUVfQ01EX0VG
RkVDVFNfQ1NVUFAgfCBOVk1FX0NNRF9FRkZFQ1RTX0xCQ0MpKQogCQkJZGV2X3dhcm4oY3RybC0+
ZGV2aWNlLAogCQkJCSAiSU8gY29tbWFuZDolMDJ4IGhhcyB1bmhhbmRsZWQgZWZmZWN0czolMDh4
XG4iLApAQCAtMjg0NCw3ICsyODQ0LDcgQEAgc3RhdGljIGludCBudm1lX2luaXRfc3Vic3lzdGVt
KHN0cnVjdCBudm1lX2N0cmwgKmN0cmwsIHN0cnVjdCBudm1lX2lkX2N0cmwgKmlkKQogCXJldHVy
biByZXQ7CiB9CiAKLWludCBudm1lX2dldF9sb2coc3RydWN0IG52bWVfY3RybCAqY3RybCwgdTMy
IG5zaWQsIHU4IGxvZ19wYWdlLCB1OCBsc3AsCitpbnQgbnZtZV9nZXRfbG9nKHN0cnVjdCBudm1l
X2N0cmwgKmN0cmwsIHUzMiBuc2lkLCB1OCBsb2dfcGFnZSwgdTggbHNwLCB1OCBjc2ksCiAJCXZv
aWQgKmxvZywgc2l6ZV90IHNpemUsIHU2NCBvZmZzZXQpCiB7CiAJc3RydWN0IG52bWVfY29tbWFu
ZCBjID0geyB9OwpAQCAtMjg1OCwyNyArMjg1OCw1NSBAQCBpbnQgbnZtZV9nZXRfbG9nKHN0cnVj
dCBudm1lX2N0cmwgKmN0cmwsIHUzMiBuc2lkLCB1OCBsb2dfcGFnZSwgdTggbHNwLAogCWMuZ2V0
X2xvZ19wYWdlLm51bWR1ID0gY3B1X3RvX2xlMTYoZHdsZW4gPj4gMTYpOwogCWMuZ2V0X2xvZ19w
YWdlLmxwb2wgPSBjcHVfdG9fbGUzMihsb3dlcl8zMl9iaXRzKG9mZnNldCkpOwogCWMuZ2V0X2xv
Z19wYWdlLmxwb3UgPSBjcHVfdG9fbGUzMih1cHBlcl8zMl9iaXRzKG9mZnNldCkpOworCWMuZ2V0
X2xvZ19wYWdlLmNzaSA9IGNzaTsKIAogCXJldHVybiBudm1lX3N1Ym1pdF9zeW5jX2NtZChjdHJs
LT5hZG1pbl9xLCAmYywgbG9nLCBzaXplKTsKIH0KIAotc3RhdGljIGludCBudm1lX2dldF9lZmZl
Y3RzX2xvZyhzdHJ1Y3QgbnZtZV9jdHJsICpjdHJsKQorc3RydWN0IG52bWVfY2VsICpudm1lX2Zp
bmRfY2VsKHN0cnVjdCBudm1lX2N0cmwgKmN0cmwsIHU4IGNzaSkKIHsKKwlzdHJ1Y3QgbnZtZV9j
ZWwgKmNlbCwgKnJldCA9IE5VTEw7CisKKwlzcGluX2xvY2soJmN0cmwtPmxvY2spOworCWxpc3Rf
Zm9yX2VhY2hfZW50cnkoY2VsLCAmY3RybC0+Y2VscywgZW50cnkpIHsKKwkJaWYgKGNlbC0+Y3Np
ID09IGNzaSkgeworCQkJcmV0ID0gY2VsOworCQkJYnJlYWs7CisJCX0KKwl9CisJc3Bpbl91bmxv
Y2soJmN0cmwtPmxvY2spOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBudm1lX2dl
dF9lZmZlY3RzX2xvZyhzdHJ1Y3QgbnZtZV9jdHJsICpjdHJsLCB1OCBjc2ksCisJCQkJc3RydWN0
IG52bWVfZWZmZWN0c19sb2cgKipsb2cpCit7CisJc3RydWN0IG52bWVfY2VsICpjZWwgPSBudm1l
X2ZpbmRfY2VsKGN0cmwsIGNzaSk7CiAJaW50IHJldDsKIAotCWlmICghY3RybC0+ZWZmZWN0cykK
LQkJY3RybC0+ZWZmZWN0cyA9IGt6YWxsb2Moc2l6ZW9mKCpjdHJsLT5lZmZlY3RzKSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKGNlbCkKKwkJZ290byBvdXQ7CiAKLQlpZiAoIWN0cmwtPmVmZmVjdHMpCi0J
CXJldHVybiAwOworCWNlbCA9IGt6YWxsb2Moc2l6ZW9mKCpjZWwpLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWNlbCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKLQlyZXQgPSBudm1lX2dldF9sb2coY3RybCwg
TlZNRV9OU0lEX0FMTCwgTlZNRV9MT0dfQ01EX0VGRkVDVFMsIDAsCi0JCQljdHJsLT5lZmZlY3Rz
LCBzaXplb2YoKmN0cmwtPmVmZmVjdHMpLCAwKTsKKwlyZXQgPSBudm1lX2dldF9sb2coY3RybCwg
TlZNRV9OU0lEX0FMTCwgTlZNRV9MT0dfQ01EX0VGRkVDVFMsIDAsIGNzaSwKKwkJCSZjZWwtPmxv
Zywgc2l6ZW9mKGNlbC0+bG9nKSwgMCk7CiAJaWYgKHJldCkgewotCQlrZnJlZShjdHJsLT5lZmZl
Y3RzKTsKLQkJY3RybC0+ZWZmZWN0cyA9IE5VTEw7CisJCWtmcmVlKGNlbCk7CisJCXJldHVybiBy
ZXQ7CiAJfQotCXJldHVybiByZXQ7CisKKwljZWwtPmNzaSA9IGNzaTsKKworCXNwaW5fbG9jaygm
Y3RybC0+bG9jayk7CisJbGlzdF9hZGRfdGFpbCgmY2VsLT5lbnRyeSwgJmN0cmwtPmNlbHMpOwor
CXNwaW5fdW5sb2NrKCZjdHJsLT5sb2NrKTsKK291dDoKKwkqbG9nID0gJmNlbC0+bG9nOworCXJl
dHVybiAwOwogfQogCiAvKgpAQCAtMjkxMSw3ICsyOTM5LDcgQEAgaW50IG52bWVfaW5pdF9pZGVu
dGlmeShzdHJ1Y3QgbnZtZV9jdHJsICpjdHJsKQogCX0KIAogCWlmIChpZC0+bHBhICYgTlZNRV9D
VFJMX0xQQV9DTURfRUZGRUNUU19MT0cpIHsKLQkJcmV0ID0gbnZtZV9nZXRfZWZmZWN0c19sb2co
Y3RybCk7CisJCXJldCA9IG52bWVfZ2V0X2VmZmVjdHNfbG9nKGN0cmwsIE5WTUVfQ1NJX05WTSwg
JmN0cmwtPmVmZmVjdHMpOwogCQlpZiAocmV0IDwgMCkKIAkJCWdvdG8gb3V0X2ZyZWU7CiAJfQpA
QCAtMzU0NCw2ICszNTcyLDEzIEBAIHN0YXRpYyBzdHJ1Y3QgbnZtZV9uc19oZWFkICpudm1lX2Fs
bG9jX25zX2hlYWQoc3RydWN0IG52bWVfY3RybCAqY3RybCwKIAkJZ290byBvdXRfY2xlYW51cF9z
cmN1OwogCX0KIAorCWlmIChoZWFkLT5pZHMuY3NpKSB7CisJCXJldCA9IG52bWVfZ2V0X2VmZmVj
dHNfbG9nKGN0cmwsIGhlYWQtPmlkcy5jc2ksICZoZWFkLT5lZmZlY3RzKTsKKwkJaWYgKHJldCkK
KwkJCWdvdG8gb3V0X2NsZWFudXBfc3JjdTsKKwl9IGVsc2UKKwkJaGVhZC0+ZWZmZWN0cyA9IGN0
cmwtPmVmZmVjdHM7CisKIAlyZXQgPSBudm1lX21wYXRoX2FsbG9jX2Rpc2soY3RybCwgaGVhZCk7
CiAJaWYgKHJldCkKIAkJZ290byBvdXRfY2xlYW51cF9zcmN1OwpAQCAtMzg4NCw4ICszOTE5LDgg
QEAgc3RhdGljIHZvaWQgbnZtZV9jbGVhcl9jaGFuZ2VkX25zX2xvZyhzdHJ1Y3QgbnZtZV9jdHJs
ICpjdHJsKQogCSAqIHJhY2VkIHdpdGggdXMgaW4gcmVhZGluZyB0aGUgbG9nIHBhZ2UsIHdoaWNo
IGNvdWxkIGNhdXNlIHVzIHRvIG1pc3MKIAkgKiB1cGRhdGVzLgogCSAqLwotCWVycm9yID0gbnZt
ZV9nZXRfbG9nKGN0cmwsIE5WTUVfTlNJRF9BTEwsIE5WTUVfTE9HX0NIQU5HRURfTlMsIDAsIGxv
ZywKLQkJCWxvZ19zaXplLCAwKTsKKwllcnJvciA9IG52bWVfZ2V0X2xvZyhjdHJsLCBOVk1FX05T
SURfQUxMLCBOVk1FX0xPR19DSEFOR0VEX05TLCAwLAorCQkJTlZNRV9DU0lfTlZNLCBsb2csIGxv
Z19zaXplLCAwKTsKIAlpZiAoZXJyb3IpCiAJCWRldl93YXJuKGN0cmwtPmRldmljZSwKIAkJCSJy
ZWFkaW5nIGNoYW5nZWQgbnMgbG9nIGZhaWxlZDogJWRcbiIsIGVycm9yKTsKQEAgLTQwMjksOCAr
NDA2NCw4IEBAIHN0YXRpYyB2b2lkIG52bWVfZ2V0X2Z3X3Nsb3RfaW5mbyhzdHJ1Y3QgbnZtZV9j
dHJsICpjdHJsKQogCWlmICghbG9nKQogCQlyZXR1cm47CiAKLQlpZiAobnZtZV9nZXRfbG9nKGN0
cmwsIE5WTUVfTlNJRF9BTEwsIE5WTUVfTE9HX0ZXX1NMT1QsIDAsIGxvZywKLQkJCXNpemVvZigq
bG9nKSwgMCkpCisJaWYgKG52bWVfZ2V0X2xvZyhjdHJsLCBOVk1FX05TSURfQUxMLCBOVk1FX0xP
R19GV19TTE9ULCAwLCBOVk1FX0NTSV9OVk0sCisJCQlsb2csIHNpemVvZigqbG9nKSwgMCkpCiAJ
CWRldl93YXJuKGN0cmwtPmRldmljZSwgIkdldCBGVyBTTE9UIElORk8gbG9nIGVycm9yXG4iKTsK
IAlrZnJlZShsb2cpOwogfQpAQCAtNDE2NywxMSArNDIwMiwxNiBAQCBzdGF0aWMgdm9pZCBudm1l
X2ZyZWVfY3RybChzdHJ1Y3QgZGV2aWNlICpkZXYpCiAJc3RydWN0IG52bWVfY3RybCAqY3RybCA9
CiAJCWNvbnRhaW5lcl9vZihkZXYsIHN0cnVjdCBudm1lX2N0cmwsIGN0cmxfZGV2aWNlKTsKIAlz
dHJ1Y3QgbnZtZV9zdWJzeXN0ZW0gKnN1YnN5cyA9IGN0cmwtPnN1YnN5czsKKwlzdHJ1Y3QgbnZt
ZV9jZWwgKmNlbCwgKm5leHQ7CiAKIAlpZiAoc3Vic3lzICYmIGN0cmwtPmluc3RhbmNlICE9IHN1
YnN5cy0+aW5zdGFuY2UpCiAJCWlkYV9zaW1wbGVfcmVtb3ZlKCZudm1lX2luc3RhbmNlX2lkYSwg
Y3RybC0+aW5zdGFuY2UpOwogCi0Ja2ZyZWUoY3RybC0+ZWZmZWN0cyk7CisJbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKGNlbCwgbmV4dCwgJmN0cmwtPmNlbHMsIGVudHJ5KSB7CisJCWxpc3RfZGVs
KCZjZWwtPmVudHJ5KTsKKwkJa2ZyZWUoY2VsKTsKKwl9CisKIAludm1lX21wYXRoX3VuaW5pdChj
dHJsKTsKIAlfX2ZyZWVfcGFnZShjdHJsLT5kaXNjYXJkX3BhZ2UpOwogCkBAIC00MjAyLDYgKzQy
NDIsNyBAQCBpbnQgbnZtZV9pbml0X2N0cmwoc3RydWN0IG52bWVfY3RybCAqY3RybCwgc3RydWN0
IGRldmljZSAqZGV2LAogCXNwaW5fbG9ja19pbml0KCZjdHJsLT5sb2NrKTsKIAltdXRleF9pbml0
KCZjdHJsLT5zY2FuX2xvY2spOwogCUlOSVRfTElTVF9IRUFEKCZjdHJsLT5uYW1lc3BhY2VzKTsK
KwlJTklUX0xJU1RfSEVBRCgmY3RybC0+Y2Vscyk7CiAJaW5pdF9yd3NlbSgmY3RybC0+bmFtZXNw
YWNlc19yd3NlbSk7CiAJY3RybC0+ZGV2ID0gZGV2OwogCWN0cmwtPm9wcyA9IG9wczsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvbnZtZS9ob3N0L2h3bW9uLmMgYi9kcml2ZXJzL252bWUvaG9zdC9od21v
bi5jCmluZGV4IDJlNjQ3N2VkNDIwZi4uMjNiYThiZjY3OGFlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L252bWUvaG9zdC9od21vbi5jCisrKyBiL2RyaXZlcnMvbnZtZS9ob3N0L2h3bW9uLmMKQEAgLTYy
LDcgKzYyLDcgQEAgc3RhdGljIGludCBudm1lX2h3bW9uX2dldF9zbWFydF9sb2coc3RydWN0IG52
bWVfaHdtb25fZGF0YSAqZGF0YSkKIAlpbnQgcmV0OwogCiAJcmV0ID0gbnZtZV9nZXRfbG9nKGRh
dGEtPmN0cmwsIE5WTUVfTlNJRF9BTEwsIE5WTUVfTE9HX1NNQVJULCAwLAotCQkJICAgJmRhdGEt
PmxvZywgc2l6ZW9mKGRhdGEtPmxvZyksIDApOworCQkJICAgTlZNRV9DU0lfTlZNLCAmZGF0YS0+
bG9nLCBzaXplb2YoZGF0YS0+bG9nKSwgMCk7CiAKIAlyZXR1cm4gcmV0IDw9IDAgPyByZXQgOiAt
RUlPOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9udm1lL2hvc3QvbGlnaHRudm0uYyBiL2RyaXZl
cnMvbnZtZS9ob3N0L2xpZ2h0bnZtLmMKaW5kZXggNjk2MDg3NTVkNDE1Li44ZTU2MmQwZjJjMzAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbnZtZS9ob3N0L2xpZ2h0bnZtLmMKKysrIGIvZHJpdmVycy9u
dm1lL2hvc3QvbGlnaHRudm0uYwpAQCAtNTkzLDggKzU5Myw4IEBAIHN0YXRpYyBpbnQgbnZtZV9u
dm1fZ2V0X2Noa19tZXRhKHN0cnVjdCBudm1fZGV2ICpuZGV2LAogCQlkZXZfbWV0YV9vZmYgPSBk
ZXZfbWV0YTsKIAogCQlyZXQgPSBudm1lX2dldF9sb2coY3RybCwgbnMtPmhlYWQtPm5zX2lkLAot
CQkJCU5WTUVfTlZNX0xPR19SRVBPUlRfQ0hVTkssIDAsIGRldl9tZXRhLCBsZW4sCi0JCQkJb2Zm
c2V0KTsKKwkJCQlOVk1FX05WTV9MT0dfUkVQT1JUX0NIVU5LLCAwLCBOVk1FX0NTSV9OVk0sCisJ
CQkJZGV2X21ldGEsIGxlbiwgb2Zmc2V0KTsKIAkJaWYgKHJldCkgewogCQkJZGV2X2VycihjdHJs
LT5kZXZpY2UsICJHZXQgUkVQT1JUIENIVU5LIGxvZyBlcnJvclxuIik7CiAJCQlicmVhazsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvbnZtZS9ob3N0L211bHRpcGF0aC5jIGIvZHJpdmVycy9udm1lL2hv
c3QvbXVsdGlwYXRoLmMKaW5kZXggZGE3OGU0OTk5NDdhLi5lNGJiZGYyYWNjMDkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvbnZtZS9ob3N0L211bHRpcGF0aC5jCisrKyBiL2RyaXZlcnMvbnZtZS9ob3N0
L211bHRpcGF0aC5jCkBAIC01MzEsNyArNTMxLDcgQEAgc3RhdGljIGludCBudm1lX3JlYWRfYW5h
X2xvZyhzdHJ1Y3QgbnZtZV9jdHJsICpjdHJsKQogCWludCBlcnJvcjsKIAogCW11dGV4X2xvY2so
JmN0cmwtPmFuYV9sb2NrKTsKLQllcnJvciA9IG52bWVfZ2V0X2xvZyhjdHJsLCBOVk1FX05TSURf
QUxMLCBOVk1FX0xPR19BTkEsIDAsCisJZXJyb3IgPSBudm1lX2dldF9sb2coY3RybCwgTlZNRV9O
U0lEX0FMTCwgTlZNRV9MT0dfQU5BLCAwLCBOVk1FX0NTSV9OVk0sCiAJCQljdHJsLT5hbmFfbG9n
X2J1ZiwgY3RybC0+YW5hX2xvZ19zaXplLCAwKTsKIAlpZiAoZXJyb3IpIHsKIAkJZGV2X3dhcm4o
Y3RybC0+ZGV2aWNlLCAiRmFpbGVkIHRvIGdldCBBTkEgbG9nOiAlZFxuIiwgZXJyb3IpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9udm1lL2hvc3QvbnZtZS5oIGIvZHJpdmVycy9udm1lL2hvc3QvbnZt
ZS5oCmluZGV4IGE4NGY3MTQ1OWNhYS4uNTg0MjhlM2E1OTBlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L252bWUvaG9zdC9udm1lLmgKKysrIGIvZHJpdmVycy9udm1lL2hvc3QvbnZtZS5oCkBAIC0xOTEs
NiArMTkxLDEzIEBAIHN0cnVjdCBudm1lX2ZhdWx0X2luamVjdCB7CiAjZW5kaWYKIH07CiAKKwor
c3RydWN0IG52bWVfY2VsIHsKKwlzdHJ1Y3QgbGlzdF9oZWFkCWVudHJ5OworCXN0cnVjdCBudm1l
X2VmZmVjdHNfbG9nCWxvZzsKKwl1OAkJCWNzaTsKK307CisKIHN0cnVjdCBudm1lX2N0cmwgewog
CWJvb2wgY29tcF9zZWVuOwogCWVudW0gbnZtZV9jdHJsX3N0YXRlIHN0YXRlOwpAQCAtMjU3LDYg
KzI2NCw3IEBAIHN0cnVjdCBudm1lX2N0cmwgewogCXVuc2lnbmVkIGxvbmcgcXVpcmtzOwogCXN0
cnVjdCBudm1lX2lkX3Bvd2VyX3N0YXRlIHBzZFszMl07CiAJc3RydWN0IG52bWVfZWZmZWN0c19s
b2cgKmVmZmVjdHM7CisJc3RydWN0IGxpc3RfaGVhZCBjZWxzOwogCXN0cnVjdCB3b3JrX3N0cnVj
dCBzY2FuX3dvcms7CiAJc3RydWN0IHdvcmtfc3RydWN0IGFzeW5jX2V2ZW50X3dvcms7CiAJc3Ry
dWN0IGRlbGF5ZWRfd29yayBrYV93b3JrOwpAQCAtMzU5LDYgKzM2Nyw3IEBAIHN0cnVjdCBudm1l
X25zX2hlYWQgewogCXN0cnVjdCBrcmVmCQlyZWY7CiAJYm9vbAkJCXNoYXJlZDsKIAlpbnQJCQlp
bnN0YW5jZTsKKwlzdHJ1Y3QgbnZtZV9lZmZlY3RzX2xvZyAqZWZmZWN0czsKICNpZmRlZiBDT05G
SUdfTlZNRV9NVUxUSVBBVEgKIAlzdHJ1Y3QgZ2VuZGlzawkJKmRpc2s7CiAJc3RydWN0IGJpb19s
aXN0CQlyZXF1ZXVlX2xpc3Q7CkBAIC01NTcsNyArNTY2LDcgQEAgaW50IG52bWVfcmVzZXRfY3Ry
bF9zeW5jKHN0cnVjdCBudm1lX2N0cmwgKmN0cmwpOwogaW50IG52bWVfdHJ5X3NjaGVkX3Jlc2V0
KHN0cnVjdCBudm1lX2N0cmwgKmN0cmwpOwogaW50IG52bWVfZGVsZXRlX2N0cmwoc3RydWN0IG52
bWVfY3RybCAqY3RybCk7CiAKLWludCBudm1lX2dldF9sb2coc3RydWN0IG52bWVfY3RybCAqY3Ry
bCwgdTMyIG5zaWQsIHU4IGxvZ19wYWdlLCB1OCBsc3AsCitpbnQgbnZtZV9nZXRfbG9nKHN0cnVj
dCBudm1lX2N0cmwgKmN0cmwsIHUzMiBuc2lkLCB1OCBsb2dfcGFnZSwgdTggbHNwLCB1OCBjc2ks
CiAJCXZvaWQgKmxvZywgc2l6ZV90IHNpemUsIHU2NCBvZmZzZXQpOwogCiBleHRlcm4gY29uc3Qg
c3RydWN0IGF0dHJpYnV0ZV9ncm91cCAqbnZtZV9uc19pZF9hdHRyX2dyb3Vwc1tdOwpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9saW51eC9udm1lLmggYi9pbmNsdWRlL2xpbnV4L252bWUuaAppbmRleCA4
MWZmZTUyNDc1MDUuLjk1Y2QwM2UyNDBhMSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9udm1l
LmgKKysrIGIvaW5jbHVkZS9saW51eC9udm1lLmgKQEAgLTExMDEsNyArMTEwMSw5IEBAIHN0cnVj
dCBudm1lX2dldF9sb2dfcGFnZV9jb21tYW5kIHsKIAkJfTsKIAkJX19sZTY0IGxwbzsKIAl9Owot
CV9fdTMyCQkJcnN2ZDE0WzJdOworCV9fdTgJCQlyc3ZkMTRbM107CisJX191OAkJCWNzaTsKKwlf
X3UzMgkJCXJzdmQxNTsKIH07CiAKIHN0cnVjdCBudm1lX2RpcmVjdGl2ZV9jbWQgewotLSAKMi4y
NC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KbGlu
dXgtbnZtZSBtYWlsaW5nIGxpc3QKbGludXgtbnZtZUBsaXN0cy5pbmZyYWRlYWQub3JnCmh0dHA6
Ly9saXN0cy5pbmZyYWRlYWQub3JnL21haWxtYW4vbGlzdGluZm8vbGludXgtbnZtZQo=
